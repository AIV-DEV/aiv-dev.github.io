---
layout: post
title: התרעות צבע אדום בהודעת SMS
---

"צבע אדום! צבע אדום!" כל ילד שגדל בעוטף עזה מכיר את המילים האלו, שבעוטף עזה מחליפות את האזעקה העולה והיורדת המוכרת בשאר ישראל בעת ירי טילים.

<img src="https://aiv-dev.com/he-IL/assets/images/IranMissileDawn.png" width="50%" />

*ירוט טיל איראני במבצע "עם כלביא" על רקע הזריחה*


עוד בשלבים מוקדמים יחסית במלחמה, עוד לפני "עם כלביא", בטילים מתימן, בפיקוד העורף החליטו להוסיף עוד התראה, התראה כ10 דקות לפני האזעקה (שהייתה בכל מקום לפי זמן ההתגוננות שלו שאליו התרלגנו בתקופת הסבבים), כדי להכין את הציבור לירידה למקלט. במבצע "עם כלביא", בו היו מטחים גדולים שנמשכו מעבר ל10 דקות, השתנו ההנחיות - שעד אז היו לשהות במרחבים המוגנים כ10 דקות - לכניסה למרחב המוגן מהאזעקה ועד להודעה חדשה. מה הבעיה? האזעקה היחידה שהופעלה בצופרים, הייתה האזעקה הרגילה. ההתראות האחרות הגיעו לטלפונים דרך האפליקציה. אבל מה לעשות עם מי שיש לו טלפון פשוט או שלא התקין את האפליקציה? לשם כך השתמשו בפיקוד העורף בטכנולגיה שנקראת התראות CB, שמציגה פופאפ על מסך הטלפון עם תוכן ההתראה, ומצפצפת גם אם הטלפון על מצב שקט:


<img src="https://aiv-dev.com/he-IL/assets/images/CB_Alert.jpeg" width="50%" />
 

עכשיו, במוצ"ש זכור תשפ"ו, כשהיום בבוקר התחיל מבצע "שאגת הארי" בו ישראל וארה"ב תוקפות באיראן, אני רוצה להציג פיתוח שלי (ושל חברי, [שילה סיאני](https://github.com/shilosiani)) מתקופת עם כלביא. הבעיה הייתה, שהתראות הCB הגיעו רק לטלפונים בדור 4, וגם אז לא לכולם. ופקע"ר השתמשו בטכנולוגיה הזו רק להתראות לפני האזעקה, ולא את ההתראה שמודיעה שאפשר לצאת.

 בקיצור... ישיבה בדרום הארץ (שעד אז, בגלל המיקום הנידח, לא כל כך הייתה תחת אזעקות. למעשה אפילו ב"עם כלביא" הייתה להם רק אזעקת אמת אחת) פנתה לשנינו וביקשה לפתח מערכת שתשלח את התראות פקע"ר בSMS לתלמידים.

 אז איך לעשות את זה? שליחת SMS זה החלק הקל. השתמשנו בAPI העסקי של חברת 019 (דוגמאות לשימוש בAPI ניתן למצוא כאן). אבל לקבל את התראות פיקוד העורף... אין API רשמי. אז חיפשנו ברשת, ומצאנו את קובץ הjson הזה - לפי הדיווחים ניתן לגשת אליו רק מישראל (והוא לא חוסם בכלל, חודשים אנחנו מריצים אליו בקשות ולא נחסמנו).
 
 [https://www.oref.org.il/WarningMessages/alert/alerts.json](https://www.oref.org.il/WarningMessages/alert/alerts.json)

 אז הפעלנו סקריפט פייתון שקרא את התוכן של הקובץ במשך כמה זמן, עד שהבנו את המבנה שלו, ואיך בדיוק מתעדכנות שם ההתראות, וכתבנו סקריפט פייתון שבודק כל שניה אם יש התראה חדשה, בודק אם היא במקום שהגדרנו (כדי שלא תשלח התראה בSMS על כל אזעקה ברחבי הארץ...) ואם כן מחכה 100 שניות לפני בדיקה חוזרת (כי כל התראה נשארת כדקה וחצי בקובץ הjson הזה לפני שהיא נמחקת משם). ואז ההתראה נשלחת בSMS, וככה תלמידי אותה ישיבה - שמשתמשים בטלפונים פשוטים, חלקם אפילו בדור 3, ככה שהדרכים האחרות לא היו לגמרי רלוונטיות עבורם - קיבלו את כל 3 התראות פקע"ר בSMS. לדבג את התוכנה זה די קשה, הרי אנחנו לא שולטים מה יעלה ומתי בjson של פקע"ר, נכון? אז אחרי שהבנו את מבנה הjson, יצרנו json זהה משלנו - גם הוא קיים בrepo שלנו - שאותו אפשר לשים באתר שלכם (או במקרה שלנו, בGithub pages) ולערוך את הקוד כך שיסרוק אותו.

 הנה הrepo של התוכנה:

[https://github.com/shilosiani/CobaltRedAlert](https://github.com/shilosiani/CobaltRedAlert)

בתפילה לניצחון על כל אויבינו.
